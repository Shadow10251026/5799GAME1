<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>æ‹¼å›¾æ¸¸æˆ - å¤šå…³å¡</title>
  <link rel="stylesheet" href="style.css" />
</head>

<style>
    body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  text-align: center;
  background-color: #696AAD;
  margin: 0;
  padding: 100px 100px;
}

h1 {
  font-size: 2.2em;
  color: #ffffff;
  margin-bottom: 10px;
}

#puzzle {
  margin: 20px auto;
  display: grid;
  border: 0px solid #e7e7e7;
  border-radius: 5px;
  background-color: #fff;
}

.tile {
  background-image: url('../img/æ›¼é™€ç½—.jpg'); /* å¯æ¢æˆä½ çš„å›¾ç‰‡ */
  background-size: cover;
  border: 1px solid #ffffff;
  cursor: pointer;

  border-radius: 5px;
}


p {
  font-size: 1.1em;
  color: #ffffff;
}

#level, #size {
  font-weight: bold;
  color: #9affc9;
}

#message {
  font-size: 1.3em;
  color: #ffffff;
  margin-top: 15px;
  font-weight: bold;
}

</style>
<body>
  <h1>é›¯æ·‡è±†æ¤°æ‹¼æ‹¼ä¹</h1>
  <p>å½“å‰å…³å¡ï¼š<span id="level">1</span>ï¼ˆ<span id="size">3x3</span>ï¼‰</p>
  <div id="puzzle"></div>
  <p id="message"></p>
  <script src="script.js"></script>
</body>
</html>

<script>
const puzzle = document.getElementById("puzzle");
const levelDisplay = document.getElementById("level");
const sizeDisplay = document.getElementById("size");
const message = document.getElementById("message");

// ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¤šå¼ å›¾ç‰‡è·¯å¾„
const images = [
  "../æ‹¼å›¾ï½œå›¾/æ‹¼å›¾æ¸¸æˆ1.jpg",
  "../img/è¿åŠ¨ä¼šç‰µæ‰‹.jpg",
  "../img/é›¯æ·‡ç»“å©šå¤´åƒ.png",
  "../img/æ›¼é™€ç½—.jpg"
];

let usedImages = [];
let currentImage = "";
let level = 1;
let gridSize = 2;
let tiles = [];
let firstClicked = null;

function pickRandomImage() {
  const available = images.filter(img => !usedImages.includes(img));
  if (available.length === 0) {
    message.textContent = "ğŸ‰ æ‰€æœ‰å›¾ç‰‡å·²å®ŒæˆæŒ‘æˆ˜ï¼æ¸¸æˆç»“æŸ";
    return null;
  }
  const random = available[Math.floor(Math.random() * available.length)];
  usedImages.push(random);
  return random;
}

function startLevel() {
  if (usedImages.length === images.length) {
    return;
  }

  gridSize = level + 1;
  levelDisplay.textContent = level;
  sizeDisplay.textContent = `${gridSize}x${gridSize}`;
  message.textContent = '';

  const img = pickRandomImage();
  if (!img) return;

  currentImage = img;
  createTiles();
  shuffle();
}

function createTiles() {
  puzzle.innerHTML = '';
  tiles = [];

  puzzle.style.width = `${gridSize * 100}px`;
  puzzle.style.height = `${gridSize * 100}px`;
  puzzle.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
  puzzle.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;

  const total = gridSize * gridSize;

  for (let i = 0; i < total; i++) {
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.dataset.index = i;

    const x = i % gridSize;
    const y = Math.floor(i / gridSize);
    tile.style.width = `${100}px`;
    tile.style.height = `${100}px`;
    tile.style.backgroundImage = `url('${currentImage}')`;
    tile.style.backgroundSize = `${gridSize * 100}px ${gridSize * 100}px`;
    tile.style.backgroundPosition = `-${x * 100}px -${y * 100}px`;

    tile.addEventListener("click", onTileClick);
    tiles.push(tile);
  }
}

function shuffle() {
  const shuffled = [...tiles];
  shuffled.sort(() => Math.random() - 0.5);
  puzzle.innerHTML = '';
  shuffled.forEach(tile => puzzle.appendChild(tile));
}

function onTileClick(e) {
  const tile = e.currentTarget;
  if (!firstClicked) {
    firstClicked = tile;
    tile.style.border = "2px solid red";
  } else if (tile === firstClicked) {
    tile.style.border = "1px solid #ccc";
    firstClicked = null;
  } else {
    swapTiles(firstClicked, tile);
    firstClicked.style.border = "1px solid #ccc";
    firstClicked = null;
    checkWin();
  }
}

function swapTiles(tile1, tile2) {
  const temp = document.createElement("div");
  puzzle.replaceChild(temp, tile1);
  puzzle.replaceChild(tile1, tile2);
  puzzle.replaceChild(tile2, temp);
}

function checkWin() {
  const allTiles = Array.from(puzzle.children);
  const isCorrect = allTiles.every((tile, i) => {
    return parseInt(tile.dataset.index) === i;
  });
  if (isCorrect) {
    message.textContent = `æ­å–œè¿™ä½å§”å±ˆé¬¼å®Œæˆç¬¬ ${level} å…³ï¼å‡†å¤‡è¿›å…¥ä¸‹ä¸€å…³...`;
    setTimeout(() => {
      level++;
      startLevel();
    }, 1500);
  }
}

startLevel();


</script>
